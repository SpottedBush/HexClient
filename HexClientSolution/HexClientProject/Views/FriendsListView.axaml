<UserControl
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:viewModels="clr-namespace:HexClientProject.ViewModels"
    x:Class="HexClientProject.Views.FriendsListView"
    x:DataType="viewModels:FriendsListViewModel">

    <StackPanel Margin="20" Spacing="10">

        <!-- Search box -->
        <!-- <TextBox Watermark="Search..." Width="200" Text="{Binding}"/> -->

        <!-- Add the friend section -->
        <StackPanel Orientation="Horizontal" Spacing="10">
            <TextBox Width="200" Watermark="Enter friend to add name..." Text="{Binding NewFriendUsername, UpdateSourceTrigger=PropertyChanged}" KeyDown="TextBox_OnKeyDown" />
            <Button Content="Add Friend" Command="{Binding AddFriendCommand}" />
        </StackPanel>

        <!-- Remove the friend section -->
        <!-- <StackPanel Orientation="Horizontal" Spacing="10"> -->
        <!--     <TextBox Width="200" Watermark="Enter name to remove..." Text="{Binding RemoveFriendCommand}" /> -->
        <!--     <Button Content="Remove Friend" Command="{Binding RemoveFriendCommand}" /> -->
        <!-- </StackPanel> -->

        <!-- Friend list -->
        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <ListBox ItemsSource="{Binding Friends}" SelectedItem="{Binding SelectedFriend}" MaxHeight="450">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Border Background="Transparent" PointerPressed="OnFriendClicked" Padding="5">
                            <Border.ContextFlyout>
                                <Flyout Placement="Right">
                                    <StackPanel Width="150">
                                        <Button Content="View profile"
                                                Command="{Binding ParentViewModel.WhisperToCommand}" 
                                                CommandParameter="{Binding .}"
                                                Click="Popup_Click"/>
                                        <Button Content="Message"
                                                Command="{Binding ParentViewModel.WhisperToCommand}" 
                                                CommandParameter="{Binding .}"
                                                Click="Popup_Click"/>
                                        <Button Content="Invite to your party"
                                                Command="{Binding ParentViewModel.InviteToLobbyCommand}" 
                                                CommandParameter="{Binding .}"
                                                Click="Popup_Click"/>
                                        <Button Content="Mute Friend"
                                                Command="{Binding ParentViewModel.MuteUserCommand}" 
                                                CommandParameter="{Binding .}"
                                                Click="Popup_Click"/>
                                        <Button Content="Remove Friend"
                                                Command="{Binding ParentViewModel.RemoveFriendCommand}" 
                                                CommandParameter="{Binding .}"
                                                Click="Popup_Click"/>
                                        <Button Content="Block"
                                                Command="{Binding ParentViewModel.BlockFriendCommand}" 
                                                CommandParameter="{Binding .}"
                                                Click="Popup_Click"/>
                                    </StackPanel>
                                </Flyout>
                            </Border.ContextFlyout>

                            <!-- Friend Info -->
                            <StackPanel>
                                <TextBlock Text="{Binding Username}" FontWeight="Bold"/>
                                <Grid ColumnDefinitions="Auto,*,Auto">
                                    <TextBlock Text="Status:" Grid.Column="0" Margin="0,0,5,0"/>
                                    <TextBlock Text="{Binding Status}" Grid.Column="1"/>
                                </Grid>
                                <Grid ColumnDefinitions="Auto,*,Auto">
                                    <TextBlock Text="Level:" Grid.Column="0" Margin="0,0,5,0"/>
                                    <TextBlock Text="{Binding Level}" Grid.Column="1"/>
                                    <TextBlock Text="{Binding RankDisplay}" Grid.Column="2" HorizontalAlignment="Right"/>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </ScrollViewer>
    </StackPanel>
</UserControl>

